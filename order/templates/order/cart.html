{% extends 'layout/base.html' %}
{% load static %}
{% load humanize %}
{% load order %}
{% load widget_tweaks %}

{% block title %}
    Giỏ hàng
{% endblock %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'order/cart.css' %}">
{% endblock %}

{% block content %}

    <div class="container wrapper">
        <div class="row">
            <div class="col-md-8">
                {#                 List of items in cart #}
                {#                <div class="panel-body border">#}
                <div class="card card-1">
                    <div class="table-responsive">
                        <form action="" method="POST">
                            {% csrf_token %}

                            <table class="table">
                                <thead align="center">
                                <tr>
                                    <td class="col-md-1 ">&nbsp;</td>
                                    <td class="col-md-2">&nbsp;</td>
                                    <td class="pcol-md-3"><h4>Product</h4></td>
                                    <td class="col-md-2"><h4>Price</h4></td>
                                    <td class="col-md-2"><h4>Quantity</h4></td>
                                    <td class="col-md-2"><h4>Total</h4></td>
                                </tr>
                                </thead>
                                <tbody>
                                {{ form.management_form }}
                                {% for field in form %}
                                    <tr>
                                        {% get_item field.item_id.value as item %}
                                        {% get_subtotal field.item_id.value field.quantity.value as sub_total %}
                                        <input type="hidden" name="form-{{ forloop.counter0 }}-{{ field.item_id.name }}"
                                               value="{{ field.item_id.value }}"/>

                                        <td class="col-md-1 vert-align">
                                            <form id="fz-{{ field.item_id.value }}" method="POST"
                                                  action="{% url 'order:remove' %}">
                                                {% csrf_token %}
                                                <input id="item_id-{{ field.item_id.value }}" name="item_id"
                                                       type="hidden"
                                                       value="{{ field.item_id.value }}">
                                                <button
                                                        onclick="document.forms['f-{{ field.item_id.value }}'].submit(); return false;">
                                                    <span class="glyphicon glyphicon-trash"> </span>
                                                </button>
                                                {#                                                <input type='button' value='Submit form' onClick='submitForm({{ field.item_id.value }})'/>#}
                                                {#                                                <button class="btn btn-default" id="save-{{ category.name }}"#}
                                                {#                                                        onclick="post('{% url 'order:remove' %}', '{{ field.item_id.value }}')">#}
                                                {#                                                    Save#}
                                                {#                                                </button>#}
                                            </form>
                                        </td>

                                        <td class="col-md-2 vert-align">
                                            <a href="{% url 'item:detail' item.slug %}">
                                                <img src="{{ item.get_primary_image }}"
                                                     class="img-responsive" alt="poster_2_up"
                                                     height="120" width="120">
                                            </a>
                                        </td>

                                        <td class="col-md-3 vert-align">
                                            <a href="{% url 'item:detail' item.slug %}">
                                                <h4>{{ item.name|truncatechars:'20' }}</h4></a>
                                        </td>

                                        <td class="col-md-2 vert-align">
                                            <span>{{ item.price|intcomma }}</span>
                                        </td>

                                        <td class="col-md-2 vert-align">
                                            <div>
                                                <input name="form-{{ forloop.counter0 }}-{{ field.quantity.name }}"
                                                       step="1" min="1" value="{{ field.quantity.value }}" title="Qty"
                                                       class="form-control input-sm" size="4" type="number">
                                            </div>
                                        </td>

                                        <td class="col-md-2 vert-align">
                                            <span class="amount">{{ sub_total|intcomma }}</span>
                                        </td>
                                    </tr>
                                {% endfor %}
                                <tr>
                                    <td colspan="6"></td>
                                </tr>
                                </tbody>
                            </table>
                            <input class="custom-button pull-right" name="update_cart" value="Update Cart"
                                   type="submit">
                        </form>
                    </div>

                    {#                                        <form action="" method="POST" id="formId">#}
                    {#                                            {% csrf_token %}#}
                    {##}
                    {#                                            {{ form.management_form }}#}
                    {#                                            {% for field in form %}#}
                    {#                                                {% with field.item_id.value as id %}#}
                    {#                                                {% get_item field.item_id.value as item %}#}
                    {#                                                {% get_subtotal field.item_id.value field.quantity.value as sub_total %}#}
                    {#                                                <input type="hidden" name="form-{{ forloop.counter0 }}-{{ field.item_id.name }}"#}
                    {#                                                       value="{{ field.item_id.value }}"/>#}
                    {##}
                    {#                                                <div class="row">#}
                    {#                                                    <div class="col-xs-2">#}
                    {#                                                        <img class="img-responsive" src="{{ item.get_primary_image }}">#}
                    {#                                                    </div>#}
                    {##}
                    {#                                                    <div class="col-xs-4">#}
                    {#                                                        <a href="{% url 'item:detail' item.slug %}">#}
                    {#                                                            <h4 class="product-name">#}
                    {#                                                                {{ item.name }}#}
                    {#                                                            </h4>#}
                    {#                                                        </a>#}
                    {#                                                    </div>#}
                    {##}
                    {#                                                    <div class="col-xs-6">#}
                    {#                                                        <div class="col-xs-4">#}
                    {#                     Update form#}
                    {#                                                                <form id="f-{{ id }}" method="POST" action="{% url 'order:update' %}">#}
                    {#                                                                    {% csrf_token %}#}
                    {#                                                                    <input name="item_id" type="hidden" value="{{ id }}">#}
                    {#                                                            <input id="input-{{ field.item_id.value }}"#}
                    {#                                                                   name="form-{{ forloop.counter0 }}-{{ field.quantity.name }}"#}
                    {#                                                                   type="number"#}
                    {#                                                                   class="form-control input-sm"#}
                    {#                                                                   min="1" step="1"#}
                    {#                                                                   value="{{ field.quantity.value }}">#}
                    {#                                                                </form>#}
                    {#                                                        </div>#}
                    {#                                                        <div class="col-xs-6 text-right">#}
                    {#                                                            <h4><strong>#}
                    {#                                                                <span class="text-muted">{{ sub_total|intcomma }}</span>#}
                    {#                                                            </strong></h4>#}
                    {#                                                        </div>#}
                    {#                                                        <div class="col-xs-2">#}
                    {#                     Delete form #}
                    {#                                                            <form id="form-{{ field.item_id.value }}" method="POST"#}
                    {#                                                                  action="{% url 'order:remove' %}">#}
                    {#                                                                {% csrf_token %}#}
                    {#                                                                <input name="item_id" type="hidden" value="{{ field.item_id.value }}">#}
                    {#                                                                <a href="#"#}
                    {#                                                                   onclick="document.forms['form-{{ field.item_id.value }}'].submit(); return false;">#}
                    {#                                                                    <span class="glyphicon glyphicon-trash"> </span>#}
                    {#                                                                </a>#}
                    {#                                                            </form>#}
                    {#                                                        </div>#}
                    {#                                                    </div>#}
                    {#                                                </div>#}
                    {#                                                <hr>#}
                    {#                                                {% endwith %}#}
                    {#                                            {% endfor %}#}
                    {#                                            <input type='button' value='Submit form' onClick='submitForm()'/>#}
                    {#                                            <input class="btn btn-default" value="Update Cart" type="submit">#}
                    {#                                        </form>#}
                </div>
            </div>

            <div class="col-md-4">
                <div class="row">
                    <div class="card card-1">
                        <h4>Đồ Thêm</h4>
                        <div id="Carousel" class="carousel slide">

                            <!-- Carousel items -->
                            <div class="carousel-inner">

                                <div class="item active">
                                    <div class="row">
                                        <div class="col-md-4"><a href="#" class="thumbnail"><img src="../img/coca.jpg"
                                                                                                 alt="Image"
                                                                                                 style="max-width:100%;"></a>
                                        </div>
                                        <div class="col-md-4"><a href="#" class="thumbnail"><img src="../img/pepsi.jpg"
                                                                                                 alt="Image"
                                                                                                 style="max-width:100%;"></a>
                                        </div>
                                        <div class="col-md-4"><a href="#" class="thumbnail"><img src="../img/sprite.jpg"
                                                                                                 alt="Image"
                                                                                                 style="max-width:100%;"></a>
                                        </div>
                                    </div><!--.row-->
                                </div><!--.item-->


                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="card card-1">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Thành Tiền</h4>
                            </div>
                            <div class="col-md-6">
                                <div class="text-right">
                                    <h4 id="total"><strong></strong> vnd</h4>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Tiền ship</h4>
                            </div>
                            <div class="col-md-6">
                                <div class="text-right">
                                    <h4><strong>10.000</strong> vnd</h4>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-6 col-xs-6">
                                <input type="text" class="form-control input-sm" placeholder="Mã giảm giá">
                            </div>
                            <div class="col-md-6 ">
                                <div class="text-right">
                                    <button type="button" class="custom-button">
                                        Áp Dụng
                                    </button>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Tổng số tiền</h4>
                            </div>
                            <div class="col-md-6">
                                <div class="text-right">
                                    <h4><strong>240.000</strong> vnd</h4>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div style="text-align: center">
                                    <button type="button" class="custom-button next_button">
                                        Next
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="push"></div>
    </div>

{% endblock %}

{% block footer %}
    <script language="javascript" type="text/javascript">
        function submitForm() {
            $("#formId").submit();
        }

        function post(path, inputId) {
            method = "post"; // Set method to post by default

            // New name is current value of the input
            {#            var new_name = document.getElementById(inputId).value;#}

            // Create a form
            var form = document.createElement("form");
            form.setAttribute("method", method);
            form.setAttribute("action", path);

            // Create an input field to a form for submitting
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", "item_id");
            hiddenField.setAttribute("value", inputId);

            form.appendChild(hiddenField);

            {#            if (confirm('Save with new name?')) {#}
            document.body.appendChild(form);
            form.submit();
            alert('hoho');
            {#            }#}
        }
        {#        $('.toAdd').live('change', function () {#}
        {#            var total = 0;#}
        {##}
        {#            $('.toAdd').each(function () {#}
        {#                total += $(this).val();#}
        {#            });#}
        {##}
        {#            $('#total').text(total);#}
        {#            alert(total)#}
        {#        });#}
        {#        $(document).ready(function () {#}
        {#            alert(total)#}
        {#        });#}

        {#        var elems = document.getElementsByClassName('toAdd');#}
        {##}
        {#        var myLength = elems.length,#}
        {#                total = 0;#}
        {##}
        {#        for (var i = 0; i < myLength; ++i) {#}
        {#            total += elems[i].value;#}
        {#            alert(elems[i].value)#}
        {#        }#}
        {##}
        {#        document.getElementById('total').textContent = total;#}
    </script>
{% endblock %}
